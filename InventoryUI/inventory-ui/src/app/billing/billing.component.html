
<ul class="nav nav-tabs" style="margin-top: 15px;">
@for (tab of tabs; track tab.name; let index = $index) {
    <li class="nav-item tab-item">
        <div class="nav-link {{index==selectedTab?'active':''}}" aria-current="page">
        <div class="row">
            <div class="col-md-9" (click)="setSelectedTab(index)" style="width: 75%;">
                {{tab.name}} <mat-icon style="float: left;">receipt</mat-icon> 
            </div>
            <div class="col-md-3" style="float: right;">  <mat-icon style="float: right;" (click)="removeTab(index)" >close</mat-icon>
            </div>
        </div>
        </div>
    </li>
    }
    <li class="nav-item tab-item-add" title="Add new bill">
        <div class="nav-link" aria-current="page" (click)="addTab()">
            <mat-icon>add</mat-icon>
        </div>
    </li>
    <li class="nav-item tab-item-add "  title="Search">
        <div class="nav-link" aria-current="page" (click)="openDialog()">
            <mat-icon>search</mat-icon>
        </div>
    </li>
</ul>   
<div class="container" style="margin-top:10px ;">
    <div class="row">
        <div class="col-md-8">
            
            <button mat-raised-button
                    class="bill-action-button"
                    (click)="onSubmit()">
            Complete <mat-icon>done</mat-icon>
            </button>

            <button mat-raised-button
            class="bill-action-button"
            [disabled]="tabs.length === 1"
            style="right: 0px;"
            (click)="removeTab(selectedTab)">
                Discard <mat-icon>delete</mat-icon>
                </button>

            <button mat-raised-button
            class="bill-action-button"
            
            style="right: 0px;"
            (click)="downloadBill()">
                Download <mat-icon>download</mat-icon>
                </button>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">
            <div>
                <label for="Name" style="margin-right: 20px;">Name: </label>
                <input class ="col-md-9" [(ngModel)]="tabs[selectedTab].bill.name" matInput id="Name" width="100" (focusout)="setTabName()" />
                <label for="Date" style="margin-left: 20px;">Date: {{tabs[selectedTab].bill.billDate?.toLocaleString()}}</label>
            </div>
            <div>
                <label for="Mobile" style="margin-right: 15px;">Mobile: </label>
                <input id="Mobile" [(ngModel)]="tabs[selectedTab].bill.mobile" class ="col-md-9"  />
            </div>
        </div>



    </div>
    <div class="row">
        <div style="padding: 10px;font-weight: 500;">
            <button (click)="addBillItem()" style="margin-left: 10px;" mat-raised-button>
                <mat-icon >add</mat-icon> Add Item
            </button>
        
        </div>
        <table class="table">
            <thead>
                <tr>
                <td scope="col" [width]="100">Action</td>
                <td scope="col" [width]="25">#</td>
                <td scope="col"[width]="400">Item</td>
                <td scope="col" [width]="150">Quantity</td>
                <td scope="col" [width]="150">Price</td>
                </tr>
            </thead>
            <tbody>
                @for (item of tabs[selectedTab].bill.billItems; track $index) {
                    <tr>
                        <td>
                            <mat-icon (click)="tabs[selectedTab].bill.billItems.splice($index, 1)">delete</mat-icon>
                        </td>
                        <th scope="row">{{$index+1}}</th>
                        <td>
                            <input type="text" class="col-md-10"
                            placeholder="Pick one" [(ngModel)]="item.item"
                            matInput (input)="filterOptions(item.item)"
                            [matAutocomplete]="auto">
                                <mat-autocomplete 
                            #auto="matAutocomplete"
                            [displayWith]="getTitle.bind(this)">
                            <mat-option 
                                *ngFor="let item of filtereditems" 
                                [value]="item.id">
                                {{item.name}} - {{item.car}}
                            </mat-option>
                        </mat-autocomplete> 
                        
                        </td>
                        <td>
                            <input style="width: 100%;"  [(ngModel)]="item.quantity" />
                        </td>
                        <td>
                            <input style="width: 100%;"  [(ngModel)]="item.amount" />
                        </td>
                        
                    </tr>
                }
                
                
            </tbody>
            <tfoot>
                <tr>
                    <td></td>
                    <td>Advance payment</td>
                    <td><input [(ngModel)]="tabs[selectedTab].bill.Advance"></td>
                    <td><b>Discount</b></td>
                    <td><input [(ngModel)]="tabs[selectedTab].bill.discount"></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><b>Total</b></td>
                    <td>{{calculateTotal()}}</td>
                </tr>
            </tfoot>
        </table>

    </div>
</div>
